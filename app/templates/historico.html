{% extends "base.html" %}

{% block title %}HistÃ³rico{% endblock %}

{% block content %}

<h1>ğŸ“… HistÃ³rico de AverÃ­as</h1>

<!-- ===================== -->
<!-- FILTROS -->
<!-- ===================== -->
<form method="get" style="margin-bottom:20px;">
    <label>AÃ±o:</label>
    <input type="text" name="year" value="{{ filtros.year }}" style="width:80px;">

    <label style="margin-left:10px;">Zona:</label>
    <input type="text" name="zona" value="{{ filtros.zona }}" style="width:180px;">

    <button type="submit">ğŸ” Filtrar</button>
    <a href="{{ url_for('historico') }}" style="margin-left:10px;">Limpiar</a>
</form>

<!-- ===================== -->
<!-- ESTADÃSTICAS -->
<!-- ===================== -->
<div style="display:flex; gap:20px; margin-bottom:30px;">
    <div><strong>Total avisos:</strong> {{ estadisticas.total_avisos }}</div>
    <div><strong>Zonas:</strong> {{ estadisticas.total_zonas }}</div>
    <div><strong>Zona mÃ¡s activa:</strong> {{ estadisticas.zona_mas_activa }}</div>
    <div><strong>Promedio / mes:</strong> {{ "%.1f"|format(estadisticas.promedio_mes) }}</div>
</div>

<!-- ===================== -->
<!-- HISTÃ“RICO -->
<!-- ===================== -->
{% if avisos_por_zona %}
    {% for zona, meses in avisos_por_zona.items() %}

        <div style="margin-bottom:40px;">
            <h2 style="border-bottom:2px solid #ccc;">ğŸ“ {{ zona }}</h2>

            {% for mes, avisos in meses.items() %}
                <h3 style="margin-top:20px;">ğŸ—“ {{ mes }}</h3>

                <div style="display:grid; gap:10px;">

                    {% for aviso in avisos[:10] %}
                        <div style="background:#fff; padding:12px; border-radius:6px; box-shadow:0 2px 6px rgba(0,0,0,.08);">
                            <a href="{{ url_for('aviso', id=aviso.id) }}"
                               style="font-weight:600; text-decoration:none; color:#2c3e50;">
                                {{ aviso.titulo }}
                            </a>
                            <div style="font-size:13px; color:#666;">
                                ğŸ“… {{ aviso.fecha|format_fecha }}
                                {% if aviso.ubicacion %}
                                    | ğŸ“ {{ aviso.ubicacion }}
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}

                </div>

                {% if avisos|length > 10 %}
                    <div style="margin-top:10px;">
                        <a href="{{ url_for('buscar', zona=zona, year=filtros.year) }}">
                            â• Ver todas las averÃ­as de {{ zona }}
                        </a>
                    </div>
                {% endif %}

            {% endfor %}
        </div>

    {% endfor %}
{% else %}
    <p>No hay datos para los filtros seleccionados.</p>
{% endif %}

{% endblock %}
